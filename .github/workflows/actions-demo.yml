name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions 🚀
on: [push]
jobs:
    Explore-GitHub-Actions:
        runs-on: ubuntu-latest
        steps:
            - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."
            - run: echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub!"
            - run: echo "🔎 The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
            - name: Check out repository code
              uses: actions/checkout@v4
            - run: echo "💡 The ${{ github.repository }} repository has been cloned to the runner."
            - run: echo "🖥️ The workflow is now ready to test your code on the runner."
            - name: List files in the repository
              run: |
                  ls ${{ github.workspace }}
            - run: echo "🍏 This job's status is ${{ job.status }}."
    make-output:
        runs-on: ubuntu-latest
        outputs:
            output_1: ${{ steps.gen_output.outputs.output_1 }}
            output_2: ${{ steps.gen_output.outputs.output_2 }}
            output_3: ${{ steps.gen_output.outputs.output_3 }}
        strategy:
            matrix:
                version: [1, 2, 3]
        steps:
            - name: Generate output
              id: gen_output
              run: |
                  version="${{ matrix.version }}"
                  echo "output_${version}=${version}" >> "$GITHUB_OUTPUT"
    use-output:
        runs-on: ubuntu-latest
        needs: [make-output]
        steps:
            # Will show
            # {
            #   "output_1": "1",
            #   "output_2": "2",
            #   "output_3": "3"
            # }
            - run: echo '${{ toJSON(needs.make-output.outputs) }}'
    make-new-output:
        runs-on: ubuntu-latest
        outputs:
            all_tests: ${{ steps.get_all_tests.outputs.all_tests }}
        steps:
            - uses: actions/checkout@v4
            - name: Generate Tests
              id: get_all_tests
              run: |
                  all_tests=$(./.github/scripts/generate_tests.sh | base64 -d)
                  echo "all_tests=${all_tests}" >> "$GITHUB_OUTPUT"
    make-old-output:
        name: Generate Tests Old Way
        runs-on: ubuntu-latest
        outputs:
            all_tests: ${{ steps.get_all_tests.outputs.all_tests }}
        steps:
            - uses: actions/checkout@v4
            - name: Generate Tests
              id: get_all_tests
              run: echo "::set-output name=all_tests::$(./.github/scripts/generate_tests.sh | base64 -d)"
    generate-tests:
        name: Generate Tests
        runs-on: ubuntu-latest
        outputs:
            all_tests: ${{ steps.get_all_tests.outputs.all_tests }}
        steps:
            - uses: actions/checkout@v4
            - name: Generate Tests
              id: get_all_tests
              run: echo "::set-output name=all_tests::$(./.github/scripts/generate_tests.sh | base64 -d)"
    run-test:
        name: '${{matrix.tests.name}} | ${{matrix.tests.type}} | ${{matrix.tests.syntax}} | ${{matrix.tests.api}}'
        needs:
            - generate-tests
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os: [ubuntu-latest]
                tests: ${{ fromJSON(needs.generate-tests.outputs.all_tests) || fromJSON('["dummy"]') }}
        steps:
            - name: Report full path of test
              run: echo ${{matrix.tests.path}}
    run-test-new:
        name: 'NEW ${{matrix.tests.name}} | ${{matrix.tests.type}} | ${{matrix.tests.syntax}} | ${{matrix.tests.api}}'
        needs:
            - make-new-output
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os: [ubuntu-latest]
                tests: ${{ fromJSON(needs.make-new-output.outputs.all_tests) || fromJSON('["dummy"]') }}
        steps:
            - name: Report full path of test
              run: echo ${{matrix.tests.path}}
    run-test-old:
        name: 'OLD ${{matrix.tests.name}} | ${{matrix.tests.type}} | ${{matrix.tests.syntax}} | ${{matrix.tests.api}}'
        needs:
            - make-old-output
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os: [ubuntu-latest]
                tests: ${{ fromJSON(needs.make-old-output.outputs.all_tests) || fromJSON('["dummy"]') }}
        steps:
            - name: Report full path of test
              run: echo ${{matrix.tests.path}}
    use-old-output:
        name: DUP ${{matrix.test.name}}
        needs:
            - make-old-output
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os: [ubuntu-latest]
                test: ${{ toJSON(needs.make-old-output.outputs.all_tests) }}
        steps:
            - name: Report full path of test
              run: echo '${{ toJSON(matrix.test.path) }}'
