name: Run Test

on:
    workflow_call:
        inputs:
            directories:
                required: true
                type: string
            exclude-dirs:
                required: false
                type: string
                default: ''
            link-azle:
                required: true
                type: boolean
            run-experimental:
                required: false
                type: boolean
                default: false
            fuzz:
                required: false
                type: boolean
                default: false
            call-delay:
                required: false
                type: string
                default: '.1'
            time-limit:
                required: false
                type: string
                default: '300'
            operating-system:
                type: string
                description: 'Operating system to run tests on (ubuntu, mac, or wsl-ubuntu)'

jobs:
    run-tests-ubuntu-and-mac:
        if: ${{ inputs.operating-system == 'ubuntu' || inputs.operating-system == 'mac' }}
        uses: ./.github/workflows/run_test_ubuntu_and_mac.yml
        with:
            directories: ${{ inputs.directories }}
            exclude-dirs: ${{ inputs.exclude-dirs }}
            link-azle: ${{ inputs.link-azle }}
            run-experimental: ${{ inputs.run-experimental }}
            fuzz: ${{ inputs.fuzz }}
            call-delay: ${{ inputs.call-delay }}
            time-limit: ${{ inputs.time-limit }}
            operating-system: ${{ inputs.operating-system }}

    run-tests-wsl-ubuntu:
        if: ${{ inputs.operating-system == 'wsl-ubuntu' }}
        uses: ./.github/workflows/run_test_wsl_ubuntu.yml
        with:
            directories: ${{ inputs.directories }}
            exclude-dirs: ${{ inputs.exclude-dirs }}
            link-azle: ${{ inputs.link-azle }}
            run-experimental: ${{ inputs.run-experimental }}
            fuzz: ${{ inputs.fuzz }}
            call-delay: ${{ inputs.call-delay }}
            time-limit: ${{ inputs.time-limit }}
