name: Run Test

on:
    workflow_call:
        inputs:
            directories:
                required: true
                type: string
            exclude-dirs:
                required: false
                type: string
                default: ''
            link-azle:
                required: true
                type: boolean
            run-experimental:
                required: false
                type: boolean
                default: false
            fuzz:
                required: false
                type: boolean
                default: false
            call-delay:
                required: false
                type: string
                default: '.1'
            time-limit:
                required: false
                type: string
                default: '300'
            operating-system:
                required: false
                type: string
                default: 'linux'
                description: 'Operating system to run tests on (linux, mac, or windows)'

jobs:
    run-unix-tests:
        if: ${{ inputs.operating-system != 'windows' }}
        uses: ./.github/workflows/run_test_unix.yml
        with:
            directories: ${{ inputs.directories }}
            exclude-dirs: ${{ inputs.exclude-dirs }}
            link-azle: ${{ inputs.link-azle }}
            run-experimental: ${{ inputs.run-experimental }}
            fuzz: ${{ inputs.fuzz }}
            call-delay: ${{ inputs.call-delay }}
            time-limit: ${{ inputs.time-limit }}
            operating-system: ${{ inputs.operating-system }}
        secrets: inherit

    run-windows-tests:
        if: ${{ inputs.operating-system == 'windows' }}
        uses: ./.github/workflows/run_test_windows.yml
        with:
            directories: ${{ inputs.directories }}
            exclude-dirs: ${{ inputs.exclude-dirs }}
            link-azle: ${{ inputs.link-azle }}
            run-experimental: ${{ inputs.run-experimental }}
            fuzz: ${{ inputs.fuzz }}
            call-delay: ${{ inputs.call-delay }}
            time-limit: ${{ inputs.time-limit }}
        secrets: inherit
