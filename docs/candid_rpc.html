<!DOCTYPE html>
<html
    lang="en"
    class="light sidebar-visible"
    dir="ltr"
>
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8" />
        <title>Candid RPC - The Azle Book</title>

        <!-- Custom HTML head -->

        <meta
            name="description"
            content=""
        />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1"
        />
        <meta
            name="theme-color"
            content="#ffffff"
        />

        <link
            rel="icon"
            href="favicon.svg"
        />
        <link
            rel="shortcut icon"
            href="favicon.png"
        />
        <link
            rel="stylesheet"
            href="css/variables.css"
        />
        <link
            rel="stylesheet"
            href="css/general.css"
        />
        <link
            rel="stylesheet"
            href="css/chrome.css"
        />
        <link
            rel="stylesheet"
            href="css/print.css"
            media="print"
        />

        <!-- Fonts -->
        <link
            rel="stylesheet"
            href="FontAwesome/css/font-awesome.css"
        />
        <link
            rel="stylesheet"
            href="fonts/fonts.css"
        />

        <!-- Highlight.js Stylesheets -->
        <link
            rel="stylesheet"
            href="highlight.css"
        />
        <link
            rel="stylesheet"
            href="tomorrow-night.css"
        />
        <link
            rel="stylesheet"
            href="ayu-highlight.css"
        />

        <!-- Custom theme stylesheets -->

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = '';
            var default_theme = window.matchMedia(
                '(prefers-color-scheme: dark)'
            ).matches
                ? 'navy'
                : 'light';
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
        <div id="body-container">
            <!-- Work around some values being stored in localStorage wrapped in quotes -->
            <script>
                try {
                    var theme = localStorage.getItem('mdbook-theme');
                    var sidebar = localStorage.getItem('mdbook-sidebar');

                    if (theme.startsWith('"') && theme.endsWith('"')) {
                        localStorage.setItem(
                            'mdbook-theme',
                            theme.slice(1, theme.length - 1)
                        );
                    }

                    if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                        localStorage.setItem(
                            'mdbook-sidebar',
                            sidebar.slice(1, sidebar.length - 1)
                        );
                    }
                } catch (e) {}
            </script>

            <!-- Set the theme before any content is loaded, prevents flash -->
            <script>
                var theme;
                try {
                    theme = localStorage.getItem('mdbook-theme');
                } catch (e) {}
                if (theme === null || theme === undefined) {
                    theme = default_theme;
                }
                const html = document.documentElement;
                html.classList.remove('light');
                html.classList.add(theme);
                html.classList.add('js');
            </script>

            <input
                type="checkbox"
                id="sidebar-toggle-anchor"
                class="hidden"
            />

            <!-- Hide / unhide sidebar before it is displayed -->
            <script>
                var sidebar = null;
                var sidebar_toggle = document.getElementById(
                    'sidebar-toggle-anchor'
                );
                if (document.body.clientWidth >= 1080) {
                    try {
                        sidebar = localStorage.getItem('mdbook-sidebar');
                    } catch (e) {}
                    sidebar = sidebar || 'visible';
                } else {
                    sidebar = 'hidden';
                }
                sidebar_toggle.checked = sidebar === 'visible';
                html.classList.remove('sidebar-visible');
                html.classList.add('sidebar-' + sidebar);
            </script>

            <nav
                id="sidebar"
                class="sidebar"
                aria-label="Table of contents"
            >
                <!-- populated by js -->
                <mdbook-sidebar-scrollbox
                    class="sidebar-scrollbox"
                ></mdbook-sidebar-scrollbox>
                <noscript>
                    <iframe
                        class="sidebar-iframe-outer"
                        src="toc.html"
                    ></iframe>
                </noscript>
                <div
                    id="sidebar-resize-handle"
                    class="sidebar-resize-handle"
                >
                    <div class="sidebar-resize-indicator"></div>
                </div>
            </nav>

            <div
                id="page-wrapper"
                class="page-wrapper"
            >
                <div class="page">
                    <div id="menu-bar-hover-placeholder"></div>
                    <div
                        id="menu-bar"
                        class="menu-bar sticky"
                    >
                        <div class="left-buttons">
                            <label
                                id="sidebar-toggle"
                                class="icon-button"
                                for="sidebar-toggle-anchor"
                                title="Toggle Table of Contents"
                                aria-label="Toggle Table of Contents"
                                aria-controls="sidebar"
                            >
                                <i class="fa fa-bars"></i>
                            </label>
                            <button
                                id="theme-toggle"
                                class="icon-button"
                                type="button"
                                title="Change theme"
                                aria-label="Change theme"
                                aria-haspopup="true"
                                aria-expanded="false"
                                aria-controls="theme-list"
                            >
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul
                                id="theme-list"
                                class="theme-popup"
                                aria-label="Themes"
                                role="menu"
                            >
                                <li role="none">
                                    <button
                                        role="menuitem"
                                        class="theme"
                                        id="light"
                                    >
                                        Light
                                    </button>
                                </li>
                                <li role="none">
                                    <button
                                        role="menuitem"
                                        class="theme"
                                        id="rust"
                                    >
                                        Rust
                                    </button>
                                </li>
                                <li role="none">
                                    <button
                                        role="menuitem"
                                        class="theme"
                                        id="coal"
                                    >
                                        Coal
                                    </button>
                                </li>
                                <li role="none">
                                    <button
                                        role="menuitem"
                                        class="theme"
                                        id="navy"
                                    >
                                        Navy
                                    </button>
                                </li>
                                <li role="none">
                                    <button
                                        role="menuitem"
                                        class="theme"
                                        id="ayu"
                                    >
                                        Ayu
                                    </button>
                                </li>
                            </ul>
                            <button
                                id="search-toggle"
                                class="icon-button"
                                type="button"
                                title="Search. (Shortkey: s)"
                                aria-label="Toggle Searchbar"
                                aria-expanded="false"
                                aria-keyshortcuts="S"
                                aria-controls="searchbar"
                            >
                                <i class="fa fa-search"></i>
                            </button>
                        </div>

                        <h1 class="menu-title">The Azle Book</h1>

                        <div class="right-buttons">
                            <a
                                href="print.html"
                                title="Print this book"
                                aria-label="Print this book"
                            >
                                <i
                                    id="print-button"
                                    class="fa fa-print"
                                ></i>
                            </a>
                        </div>
                    </div>

                    <div
                        id="search-wrapper"
                        class="hidden"
                    >
                        <form
                            id="searchbar-outer"
                            class="searchbar-outer"
                        >
                            <input
                                type="search"
                                id="searchbar"
                                name="searchbar"
                                placeholder="Search this book ..."
                                aria-controls="searchresults-outer"
                                aria-describedby="searchresults-header"
                            />
                        </form>
                        <div
                            id="searchresults-outer"
                            class="searchresults-outer hidden"
                        >
                            <div
                                id="searchresults-header"
                                class="searchresults-header"
                            ></div>
                            <ul id="searchresults"></ul>
                        </div>
                    </div>

                    <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                    <script>
                        document
                            .getElementById('sidebar-toggle')
                            .setAttribute(
                                'aria-expanded',
                                sidebar === 'visible'
                            );
                        document
                            .getElementById('sidebar')
                            .setAttribute('aria-hidden', sidebar !== 'visible');
                        Array.from(
                            document.querySelectorAll('#sidebar a')
                        ).forEach(function (link) {
                            link.setAttribute(
                                'tabIndex',
                                sidebar === 'visible' ? 0 : -1
                            );
                        });
                    </script>

                    <div
                        id="content"
                        class="content"
                    >
                        <main>
                            <h1 id="candid-rpc">
                                <a
                                    class="header"
                                    href="#candid-rpc"
                                    >Candid RPC</a
                                >
                            </h1>
                            <p>
                                This section documents the Candid RPC
                                methodology for developing Azle applications.
                                This methodology embraces ICP's Candid language,
                                exposing canister methods directly to
                                Candid-speaking clients, and using Candid for
                                serialization and deserialization purposes.
                            </p>
                            <p>
                                Candid RPC is heading towards 1.0 and
                                production-readiness in 2025.
                            </p>
                            <ul>
                                <li><a href="#get-started">Get Started</a></li>
                                <li><a href="#examples">Examples</a></li>
                                <li>
                                    <a href="#canister-class">Canister Class</a>
                                </li>
                                <li>
                                    <a href="#dfinitycandid-idl"
                                        >@dfinity/candid IDL</a
                                    >
                                </li>
                                <li>
                                    <a href="#decorators">Decorators</a>
                                    <ul>
                                        <li><a href="#query">@query</a></li>
                                        <li><a href="#update">@update</a></li>
                                        <li><a href="#init">@init</a></li>
                                        <li>
                                            <a href="#postupgrade"
                                                >@postUpgrade</a
                                            >
                                        </li>
                                        <li>
                                            <a href="#preupgrade"
                                                >@preUpgrade</a
                                            >
                                        </li>
                                        <li>
                                            <a href="#inspectmessage"
                                                >@inspectMessage</a
                                            >
                                        </li>
                                        <li>
                                            <a href="#heartbeat">@heartbeat</a>
                                        </li>
                                    </ul>
                                </li>
                                <li><a href="#ic-api">IC API</a></li>
                            </ul>
                            <h2 id="get-started">
                                <a
                                    class="header"
                                    href="#get-started"
                                    >Get Started</a
                                >
                            </h2>
                            <p>
                                Azle helps you to build secure
                                decentralized/replicated servers in TypeScript
                                or JavaScript on
                                <a href="https://internetcomputer.org/">ICP</a>.
                                The current replication factor is
                                <a
                                    href="https://dashboard.internetcomputer.org/subnets"
                                    >13-40 times</a
                                >.
                            </p>
                            <p>
                                Please remember that Azle stable mode is
                                continuously subjected to
                                <a
                                    href="https://github.com/demergent-labs/azle/actions"
                                    >intense scrutiny and testing</a
                                >, however it does not yet have multiple
                                independent security reviews/audits.
                            </p>
                            <p>Azle runs in stable mode by default.</p>
                            <p>
                                This mode is intended for production use after
                                Azle's 1.0 release. Its focus is on API and
                                runtime stability, security, performance,
                                TypeScript and JavaScript language support, the
                                ICP APIs, and Candid remote procedure calls
                                (RPC). There is minimal support for the Node.js
                                standard library, npm ecosystem, and HTTP server
                                functionality.
                            </p>
                            <h3 id="installation">
                                <a
                                    class="header"
                                    href="#installation"
                                    >Installation</a
                                >
                            </h3>
                            <blockquote>
                                <p>
                                    Windows is only supported through a Linux
                                    virtual environment of some kind, such as
                                    <a
                                        href="https://learn.microsoft.com/en-us/windows/wsl/install"
                                        >WSL</a
                                    >
                                </p>
                            </blockquote>
                            <p>
                                You will need
                                <a href="#nodejs-22">Node.js 22</a> and
                                <a href="#dfx">dfx</a> to develop ICP
                                applications with Azle:
                            </p>
                            <h4 id="nodejs-22">
                                <a
                                    class="header"
                                    href="#nodejs-22"
                                    >Node.js 22</a
                                >
                            </h4>
                            <p>
                                It's recommended to use nvm to install Node.js
                                22:
                            </p>
                            <pre><code class="language-bash">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
</code></pre>
                            <p>Restart your terminal and then run:</p>
                            <pre><code class="language-bash">nvm install 22
</code></pre>
                            <p>
                                Check that the installation went smoothly by
                                looking for clean output from the following
                                command:
                            </p>
                            <pre><code class="language-bash">node --version
</code></pre>
                            <h4 id="dfx">
                                <a
                                    class="header"
                                    href="#dfx"
                                    >dfx</a
                                >
                            </h4>
                            <p>
                                Install the dfx command line tools for managing
                                ICP applications:
                            </p>
                            <pre><code class="language-bash">DFX_VERSION=0.24.3 sh -ci "$(curl -fsSL https://internetcomputer.org/install.sh)"
</code></pre>
                            <p>
                                Check that the installation went smoothly by
                                looking for clean output from the following
                                command:
                            </p>
                            <pre><code class="language-bash">dfx --version
</code></pre>
                            <h3 id="deployment">
                                <a
                                    class="header"
                                    href="#deployment"
                                    >Deployment</a
                                >
                            </h3>
                            <p>
                                To create and deploy a simple sample application
                                called <code>hello_world</code>:
                            </p>
                            <pre><code class="language-bash"># create a new default project called hello_world
npx azle new hello_world
cd hello_world
</code></pre>
                            <pre><code class="language-bash"># install all npm dependencies including azle
npm install
</code></pre>
                            <pre><code class="language-bash"># start up a local ICP replica
dfx start --clean
</code></pre>
                            <p>
                                In a separate terminal in the
                                <code>hello_world</code> directory:
                            </p>
                            <pre><code class="language-bash"># deploy your canister
dfx deploy
</code></pre>
                            <h2 id="examples">
                                <a
                                    class="header"
                                    href="#examples"
                                    >Examples</a
                                >
                            </h2>
                            <p>
                                Some of the best documentation for creating
                                Candid RPC canisters is currently in
                                <a
                                    href="https://github.com/demergent-labs/azle/tree/main/examples/stable/test/end_to_end/candid_rpc"
                                    >the examples directory</a
                                >.
                            </p>
                            <h2 id="canister-class">
                                <a
                                    class="header"
                                    href="#canister-class"
                                    >Canister Class</a
                                >
                            </h2>
                            <p>
                                Your canister's functionality must be
                                encapsulated in a class exported using the
                                default export:
                            </p>
                            <pre><code class="language-typescript">import { IDL, query } from 'azle';

export default class {
    @query([], IDL.Text)
    hello(): string {
        return 'world!';
    }
}
</code></pre>
                            <p>
                                You must use the <a href="#query">@query</a>,
                                <a href="#update">@update</a>,
                                <a href="#init">@init</a>,
                                <a href="#postupgrade">@postUpgrade</a>,
                                <a href="#preupgrade">@preUpgrade</a>,
                                <a href="#inspectmessage">@inspectMessage</a>,
                                and
                                <a href="#heartbeat">@heartbeat</a> decorators
                                to expose your canister's methods. Adding
                                TypeScript types is optional.
                            </p>
                            <h2 id="dfinitycandid-idl">
                                <a
                                    class="header"
                                    href="#dfinitycandid-idl"
                                    >@dfinity/candid IDL</a
                                >
                            </h2>
                            <p>
                                For each of your canister's methods,
                                deserialization of incoming arguments and
                                serialization of return values is handled with a
                                combination of the <a href="#query">@query</a>,
                                <a href="#update">@update</a>,
                                <a href="#init">@init</a>, and
                                <a href="#postupgrade">@postUpgrade</a>
                                decorators and the
                                <a
                                    href="https://agent-js.icp.xyz/candid/modules/IDL.html"
                                    >IDL</a
                                >
                                object from the
                                <a
                                    href="https://agent-js.icp.xyz/candid/index.html"
                                    >@dfinity/candid</a
                                >
                                library.
                            </p>
                            <p>
                                <code>IDL</code> is re-exported by Azle, and has
                                properties that correspond to
                                <a
                                    href="https://internetcomputer.org/docs/current/references/candid-ref"
                                    >Candid's supported types</a
                                >. You must use <code>IDL</code> to instruct the
                                method decorators on how to deserialize
                                arguments and serialize the return value. Here's
                                an example of accessing the Candid types from
                                <code>IDL</code>:
                            </p>
                            <pre><code class="language-typescript">import { IDL } from 'azle';

IDL.Text;

IDL.Vec(IDL.Nat8); // Candid blob

IDL.Nat;
IDL.Nat64;
IDL.Nat32;
IDL.Nat16;
IDL.Nat8;

IDL.Int;
IDL.Int64;
IDL.Int32;
IDL.Int16;
IDL.Int8;

IDL.Float64;
IDL.Float32;

IDL.Bool;

IDL.Null;

IDL.Vec(IDL.Int);

IDL.Opt(IDL.Text);

IDL.Record({
    prop1: IDL.Text,
    prop2: IDL.Bool
});

IDL.Variant({
    Tag1: IDL.Null,
    Tag2: IDL.Nat
});

IDL.Func([], [], ['query']);

IDL.Service({
    myQueryMethod: IDL.Func([IDL.Text, IDL.Text], [IDL.Bool])
});

IDL.Principal;

IDL.Reserved;

IDL.Empty;
</code></pre>
                            <h2 id="decorators">
                                <a
                                    class="header"
                                    href="#decorators"
                                    >Decorators</a
                                >
                            </h2>
                            <h3 id="query">
                                <a
                                    class="header"
                                    href="#query"
                                    >@query</a
                                >
                            </h3>
                            <p>
                                Exposes the decorated method as a read-only
                                <code>canister_query</code> method.
                            </p>
                            <p>
                                The first parameter to this decorator accepts
                                <code>IDL</code> Candid type objects that will
                                deserialize incoming Candid arguments. The
                                second parameter to this decorator accepts an
                                <code>IDL</code> Candid type object that will
                                serialize the outgoing return value to Candid.
                            </p>
                            <h3 id="update">
                                <a
                                    class="header"
                                    href="#update"
                                    >@update</a
                                >
                            </h3>
                            <p>
                                Exposes the decorated method as a read-write
                                <code>canister_update</code> method.
                            </p>
                            <p>
                                The first parameter to this decorator accepts
                                <code>IDL</code> Candid type objects that will
                                deserialize incoming Candid arguments. The
                                second parameter to this decorator accepts an
                                <code>IDL</code> Candid type object that will
                                serialize the outgoing return value to Candid.
                            </p>
                            <h3 id="init">
                                <a
                                    class="header"
                                    href="#init"
                                    >@init</a
                                >
                            </h3>
                            <p>
                                Exposes the decorated method as the
                                <code>canister_init</code> method called only
                                once during canister initialization.
                            </p>
                            <p>
                                The first parameter to this decorator accepts
                                <code>IDL</code> Candid type objects that will
                                deserialize incoming Candid arguments.
                            </p>
                            <h3 id="postupgrade">
                                <a
                                    class="header"
                                    href="#postupgrade"
                                    >@postUpgrade</a
                                >
                            </h3>
                            <p>
                                Exposes the decorated method as the
                                <code>canister_post_upgrade</code> method called
                                during every canister upgrade.
                            </p>
                            <p>
                                The first parameter to this decorator accepts
                                <code>IDL</code> Candid type objects that will
                                deserialize incoming Candid arguments.
                            </p>
                            <h3 id="preupgrade">
                                <a
                                    class="header"
                                    href="#preupgrade"
                                    >@preUpgrade</a
                                >
                            </h3>
                            <p>
                                Exposes the decorated method as the
                                <code>canister_pre_upgrade</code> method called
                                before every canister upgrade.
                            </p>
                            <h3 id="inspectmessage">
                                <a
                                    class="header"
                                    href="#inspectmessage"
                                    >@inspectMessage</a
                                >
                            </h3>
                            <p>
                                Exposes the decorated method as the
                                <code>canister_inspect_message</code> method
                                called before every <code>update</code> call.
                            </p>
                            <h3 id="heartbeat">
                                <a
                                    class="header"
                                    href="#heartbeat"
                                    >@heartbeat</a
                                >
                            </h3>
                            <p>
                                Exposes the decorated method as the
                                <code>canister_heartbeat</code> method called on
                                a regular interval (every second or so).
                            </p>
                            <h2 id="ic-api">
                                <a
                                    class="header"
                                    href="#ic-api"
                                    >IC API</a
                                >
                            </h2>
                            <p>
                                The IC API is exposed as functions exported from
                                <code>azle</code>. You can see the available
                                functions in
                                <a
                                    href="https://github.com/demergent-labs/azle/tree/main/src/lib/stable/ic_apis"
                                    >the source code</a
                                >.
                            </p>
                            <p>
                                Some of the best documentation for using the IC
                                API is currently in
                                <a
                                    href="https://github.com/demergent-labs/azle/tree/main/examples/stable"
                                    >the examples directory</a
                                >, especially the
                                <a
                                    href="https://github.com/demergent-labs/azle/tree/main/examples/stable/test/property/ic_api"
                                    >ic_api property tests</a
                                >.
                            </p>
                            <p>
                                Here's an example of getting the caller's
                                principal using the
                                <code>caller</code> function:
                            </p>
                            <pre><code class="language-typescript">import { caller, IDL, update } from 'azle';

export default class {
    @update([], IDL.Bool)
    isUserAnonymous(): boolean {
        if (caller().toText() === '2vxsx-fae') {
            return true;
        } else {
            return false;
        }
    }
}
</code></pre>
                        </main>

                        <nav
                            class="nav-wrapper"
                            aria-label="Page navigation"
                        >
                            <!-- Mobile navigation buttons -->
                            <a
                                rel="prev"
                                href="candid_rpc_or_http_server.html"
                                class="mobile-nav-chapters previous"
                                title="Previous chapter"
                                aria-label="Previous chapter"
                                aria-keyshortcuts="Left"
                            >
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a
                                rel="next prefetch"
                                href="http_server.html"
                                class="mobile-nav-chapters next"
                                title="Next chapter"
                                aria-label="Next chapter"
                                aria-keyshortcuts="Right"
                            >
                                <i class="fa fa-angle-right"></i>
                            </a>

                            <div style="clear: both"></div>
                        </nav>
                    </div>
                </div>

                <nav
                    class="nav-wide-wrapper"
                    aria-label="Page navigation"
                >
                    <a
                        rel="prev"
                        href="candid_rpc_or_http_server.html"
                        class="nav-chapters previous"
                        title="Previous chapter"
                        aria-label="Previous chapter"
                        aria-keyshortcuts="Left"
                    >
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a
                        rel="next prefetch"
                        href="http_server.html"
                        class="nav-chapters next"
                        title="Next chapter"
                        aria-label="Next chapter"
                        aria-keyshortcuts="Right"
                    >
                        <i class="fa fa-angle-right"></i>
                    </a>
                </nav>
            </div>

            <script>
                window.playground_copyable = true;
            </script>

            <script src="elasticlunr.min.js"></script>
            <script src="mark.min.js"></script>
            <script src="searcher.js"></script>

            <script src="clipboard.min.js"></script>
            <script src="highlight.js"></script>
            <script src="book.js"></script>

            <!-- Custom JS scripts -->
        </div>
    </body>
</html>
