<!doctype html>
<html
    lang="en"
    class="light sidebar-visible"
    dir="ltr"
>
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8" />
        <title>fetch - The Azle Book</title>

        <!-- Custom HTML head -->

        <meta
            name="description"
            content=""
        />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1"
        />
        <meta
            name="theme-color"
            content="#ffffff"
        />

        <link
            rel="icon"
            href="favicon.svg"
        />
        <link
            rel="shortcut icon"
            href="favicon.png"
        />
        <link
            rel="stylesheet"
            href="css/variables.css"
        />
        <link
            rel="stylesheet"
            href="css/general.css"
        />
        <link
            rel="stylesheet"
            href="css/chrome.css"
        />
        <link
            rel="stylesheet"
            href="css/print.css"
            media="print"
        />

        <!-- Fonts -->
        <link
            rel="stylesheet"
            href="FontAwesome/css/font-awesome.css"
        />
        <link
            rel="stylesheet"
            href="fonts/fonts.css"
        />

        <!-- Highlight.js Stylesheets -->
        <link
            rel="stylesheet"
            href="highlight.css"
        />
        <link
            rel="stylesheet"
            href="tomorrow-night.css"
        />
        <link
            rel="stylesheet"
            href="ayu-highlight.css"
        />

        <!-- Custom theme stylesheets -->

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = '';
            var default_theme = window.matchMedia(
                '(prefers-color-scheme: dark)'
            ).matches
                ? 'navy'
                : 'light';
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
        <div id="body-container">
            <!-- Work around some values being stored in localStorage wrapped in quotes -->
            <script>
                try {
                    var theme = localStorage.getItem('mdbook-theme');
                    var sidebar = localStorage.getItem('mdbook-sidebar');

                    if (theme.startsWith('"') && theme.endsWith('"')) {
                        localStorage.setItem(
                            'mdbook-theme',
                            theme.slice(1, theme.length - 1)
                        );
                    }

                    if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                        localStorage.setItem(
                            'mdbook-sidebar',
                            sidebar.slice(1, sidebar.length - 1)
                        );
                    }
                } catch (e) {}
            </script>

            <!-- Set the theme before any content is loaded, prevents flash -->
            <script>
                var theme;
                try {
                    theme = localStorage.getItem('mdbook-theme');
                } catch (e) {}
                if (theme === null || theme === undefined) {
                    theme = default_theme;
                }
                const html = document.documentElement;
                html.classList.remove('light');
                html.classList.add(theme);
                html.classList.add('js');
            </script>

            <input
                type="checkbox"
                id="sidebar-toggle-anchor"
                class="hidden"
            />

            <!-- Hide / unhide sidebar before it is displayed -->
            <script>
                var sidebar = null;
                var sidebar_toggle = document.getElementById(
                    'sidebar-toggle-anchor'
                );
                if (document.body.clientWidth >= 1080) {
                    try {
                        sidebar = localStorage.getItem('mdbook-sidebar');
                    } catch (e) {}
                    sidebar = sidebar || 'visible';
                } else {
                    sidebar = 'hidden';
                }
                sidebar_toggle.checked = sidebar === 'visible';
                html.classList.remove('sidebar-visible');
                html.classList.add('sidebar-' + sidebar);
            </script>

            <nav
                id="sidebar"
                class="sidebar"
                aria-label="Table of contents"
            >
                <!-- populated by js -->
                <mdbook-sidebar-scrollbox
                    class="sidebar-scrollbox"
                ></mdbook-sidebar-scrollbox>
                <noscript>
                    <iframe
                        class="sidebar-iframe-outer"
                        src="toc.html"
                    ></iframe>
                </noscript>
                <div
                    id="sidebar-resize-handle"
                    class="sidebar-resize-handle"
                >
                    <div class="sidebar-resize-indicator"></div>
                </div>
            </nav>

            <div
                id="page-wrapper"
                class="page-wrapper"
            >
                <div class="page">
                    <div id="menu-bar-hover-placeholder"></div>
                    <div
                        id="menu-bar"
                        class="menu-bar sticky"
                    >
                        <div class="left-buttons">
                            <label
                                id="sidebar-toggle"
                                class="icon-button"
                                for="sidebar-toggle-anchor"
                                title="Toggle Table of Contents"
                                aria-label="Toggle Table of Contents"
                                aria-controls="sidebar"
                            >
                                <i class="fa fa-bars"></i>
                            </label>
                            <button
                                id="theme-toggle"
                                class="icon-button"
                                type="button"
                                title="Change theme"
                                aria-label="Change theme"
                                aria-haspopup="true"
                                aria-expanded="false"
                                aria-controls="theme-list"
                            >
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul
                                id="theme-list"
                                class="theme-popup"
                                aria-label="Themes"
                                role="menu"
                            >
                                <li role="none">
                                    <button
                                        role="menuitem"
                                        class="theme"
                                        id="light"
                                    >
                                        Light
                                    </button>
                                </li>
                                <li role="none">
                                    <button
                                        role="menuitem"
                                        class="theme"
                                        id="rust"
                                    >
                                        Rust
                                    </button>
                                </li>
                                <li role="none">
                                    <button
                                        role="menuitem"
                                        class="theme"
                                        id="coal"
                                    >
                                        Coal
                                    </button>
                                </li>
                                <li role="none">
                                    <button
                                        role="menuitem"
                                        class="theme"
                                        id="navy"
                                    >
                                        Navy
                                    </button>
                                </li>
                                <li role="none">
                                    <button
                                        role="menuitem"
                                        class="theme"
                                        id="ayu"
                                    >
                                        Ayu
                                    </button>
                                </li>
                            </ul>
                            <button
                                id="search-toggle"
                                class="icon-button"
                                type="button"
                                title="Search. (Shortkey: s)"
                                aria-label="Toggle Searchbar"
                                aria-expanded="false"
                                aria-keyshortcuts="S"
                                aria-controls="searchbar"
                            >
                                <i class="fa fa-search"></i>
                            </button>
                        </div>

                        <h1 class="menu-title">The Azle Book</h1>

                        <div class="right-buttons">
                            <a
                                href="print.html"
                                title="Print this book"
                                aria-label="Print this book"
                            >
                                <i
                                    id="print-button"
                                    class="fa fa-print"
                                ></i>
                            </a>
                        </div>
                    </div>

                    <div
                        id="search-wrapper"
                        class="hidden"
                    >
                        <form
                            id="searchbar-outer"
                            class="searchbar-outer"
                        >
                            <input
                                type="search"
                                id="searchbar"
                                name="searchbar"
                                placeholder="Search this book ..."
                                aria-controls="searchresults-outer"
                                aria-describedby="searchresults-header"
                            />
                        </form>
                        <div
                            id="searchresults-outer"
                            class="searchresults-outer hidden"
                        >
                            <div
                                id="searchresults-header"
                                class="searchresults-header"
                            ></div>
                            <ul id="searchresults"></ul>
                        </div>
                    </div>

                    <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                    <script>
                        document
                            .getElementById('sidebar-toggle')
                            .setAttribute(
                                'aria-expanded',
                                sidebar === 'visible'
                            );
                        document
                            .getElementById('sidebar')
                            .setAttribute('aria-hidden', sidebar !== 'visible');
                        Array.from(
                            document.querySelectorAll('#sidebar a')
                        ).forEach(function (link) {
                            link.setAttribute(
                                'tabIndex',
                                sidebar === 'visible' ? 0 : -1
                            );
                        });
                    </script>

                    <div
                        id="content"
                        class="content"
                    >
                        <main>
                            <h1 id="fetch-tldr">
                                <a
                                    class="header"
                                    href="#fetch-tldr"
                                    >fetch TL;DR</a
                                >
                            </h1>
                            <p>
                                Azle canisters use a custom
                                <code>fetch</code> implementation to perform
                                cross-canister calls and to perform HTTPS
                                outcalls.
                            </p>
                            <p>
                                Here's an example of performing a cross-canister
                                call:
                            </p>
                            <pre><code class="language-typescript">import { serialize } from 'azle/experimental';
import express from 'express';

const app = express();

app.use(express.json());

app.post('/cross-canister-call', async (req, res) =&gt; {
    const to: string = req.body.to;
    const amount: number = req.body.amount;

    const response = await fetch(`icp://dfdal-2uaaa-aaaaa-qaama-cai/transfer`, {
        body: serialize({
            candidPath: '/token.did',
            args: [to, amount]
        })
    });
    const responseJson = await response.json();

    res.json(responseJson);
});

app.listen();
</code></pre>
                            <p>
                                Keep these important points in mind when
                                performing a cross-canister call:
                            </p>
                            <ul>
                                <li>
                                    Use the <code>icp://</code> protocol in the
                                    URL
                                </li>
                                <li>
                                    The <code>canister id</code> of the canister
                                    that you are calling immediately follows
                                    <code>icp://</code> in the URL
                                </li>
                                <li>
                                    The <code>canister method</code> that you
                                    are calling immediately follows the
                                    <code>canister id</code> in the URL
                                </li>
                                <li>
                                    The <code>candidPath</code> property of the
                                    <code>body</code> is the path to the Candid
                                    file defining the method signatures of the
                                    canister that you are calling. You must
                                    obtain this file and copy it into your
                                    canister. See the
                                    <a href="./assets.html">Assets chapter</a>
                                    for info on copying files into your canister
                                </li>
                                <li>
                                    The <code>args</code> property of the
                                    <code>body</code> is an array of the
                                    arguments that will be passed to the
                                    <code>canister method</code> that you are
                                    calling
                                </li>
                            </ul>
                            <p>
                                Here's an example of performing an HTTPS
                                outcall:
                            </p>
                            <pre><code class="language-typescript">import express from 'express';

const app = express();

app.use(express.json());

app.post('/https-outcall', async (_req, res) =&gt; {
    const response = await fetch(`https://httpbin.org/headers`, {
        headers: {
            'X-Azle-Request-Key-0': 'X-Azle-Request-Value-0',
            'X-Azle-Request-Key-1': 'X-Azle-Request-Value-1',
            'X-Azle-Request-Key-2': 'X-Azle-Request-Value-2'
        }
    });
    const responseJson = await response.json();

    res.json(responseJson);
});

app.listen();
</code></pre>
                            <h1 id="fetch">
                                <a
                                    class="header"
                                    href="#fetch"
                                    >fetch</a
                                >
                            </h1>
                            <p>
                                Azle has custom
                                <code>fetch</code> implementations for clients
                                and canisters.
                            </p>
                            <p>
                                The client <code>fetch</code> is used for
                                authentication, and you can learn more about it
                                in the
                                <a href="./authentication.html"
                                    >Authentication chapter</a
                                >.
                            </p>
                            <p>
                                Canister <code>fetch</code> is used to perform
                                cross-canister calls and
                                <a
                                    href="https://internetcomputer.org/https-outcalls"
                                    >HTTPS outcalls</a
                                >. There are three main types of calls made with
                                canister <code>fetch</code>:
                            </p>
                            <ol>
                                <li>
                                    <a
                                        href="#cross-canister-calls-to-a-candid-canister"
                                        >Cross-canister calls to a candid
                                        canister</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="#cross-canister-calls-to-an-http-canister"
                                        >Cross-canister calls to an HTTP
                                        canister</a
                                    >
                                </li>
                                <li>
                                    <a href="#https-outcalls">HTTPS outcalls</a>
                                </li>
                            </ol>
                            <h2 id="cross-canister-calls-to-a-candid-canister">
                                <a
                                    class="header"
                                    href="#cross-canister-calls-to-a-candid-canister"
                                    >Cross-canister calls to a candid
                                    canister</a
                                >
                            </h2>
                            <p>Examples:</p>
                            <ul>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/async_await"
                                        >async_await</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/bitcoin"
                                        >bitcoin</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/canister"
                                        >canister</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/ckbtc"
                                        >ckbtc</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/composite_queries"
                                        >composite_queries</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/cross_canister_calls"
                                        >cross_canister_calls</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/cycles"
                                        >cycles</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/func_types"
                                        >func_types</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/heartbeat"
                                        >heartbeat</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/http_server/ic_evm_rpc"
                                        >ic_evm_rpc</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/icrc"
                                        >icrc</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/ledger_canister"
                                        >ledger_canister</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/management_canister"
                                        >management_canister</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/motoko_examples/threshold_ecdsa"
                                        >threshold_ecdsa</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/motoko_examples/whoami"
                                        >whoami</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/recursion"
                                        >recursion</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/rejections"
                                        >rejections</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/timers"
                                        >timers</a
                                    >
                                </li>
                            </ul>
                            <h2 id="cross-canister-calls-to-an-http-canister">
                                <a
                                    class="header"
                                    href="#cross-canister-calls-to-an-http-canister"
                                    >Cross-canister calls to an HTTP canister</a
                                >
                            </h2>
                            <p>
                                We are working on better abstractions for these
                                types of calls. For now you would just make a
                                cross-canister call using <code>icp://</code> to
                                the <code>http_request</code> and
                                <code>http_request_update</code> methods of the
                                canister that you are calling.
                            </p>
                            <h2 id="https-outcalls">
                                <a
                                    class="header"
                                    href="#https-outcalls"
                                    >HTTPS outcalls</a
                                >
                            </h2>
                            <p>Examples:</p>
                            <ul>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/ethereum_json_rpc"
                                        >ethereum_json_rpc</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/http_server/http_outcall_fetch"
                                        >http_outcall_fetch</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/demergent-labs/azle/tree/main/tests/end_to_end/candid_rpc/functional_syntax/outgoing_http_requests"
                                        >outgoing_http_requests</a
                                    >
                                </li>
                            </ul>
                            <!-- // TODO explain that you can generally only do these in POST unless the method is a query method
// TODO we have to show the imports
// TODO explain the POST, PUT, PATCH etc

TODO explain the ic.setOutgoingHttpOptions

TODO split up the examples for each type of fetch

## Canister fetch cross-canister call to a candid canister

Most canisters on ICP are not HTTP canisters. We are pushing to change this situation, but for now this is how things are. Most canisters will thus only expose Candid canister methods.

So imagine a canister that exposes this Candid update method:

```
transfer: (text, text, nat64) -> (nat64);
```

```typescript
const response = await fetch(`icp://dfdal-2uaaa-aaaaa-qaama-cai/transfer`, {
    body: serialize({
        candidPath: '/src/canister2/index.did',
        args: [from, to, amount]
    })
});
const responseJson = await response.json();

return responseJson;
```

## Canister fetch cross-canister call to an HTTP canister

## Canister fetch HTTPS outcalls -->
                        </main>

                        <nav
                            class="nav-wrapper"
                            aria-label="Page navigation"
                        >
                            <!-- Mobile navigation buttons -->
                            <a
                                rel="prev"
                                href="authentication.html"
                                class="mobile-nav-chapters previous"
                                title="Previous chapter"
                                aria-label="Previous chapter"
                                aria-keyshortcuts="Left"
                            >
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a
                                rel="next prefetch"
                                href="npm.html"
                                class="mobile-nav-chapters next"
                                title="Next chapter"
                                aria-label="Next chapter"
                                aria-keyshortcuts="Right"
                            >
                                <i class="fa fa-angle-right"></i>
                            </a>

                            <div style="clear: both"></div>
                        </nav>
                    </div>
                </div>

                <nav
                    class="nav-wide-wrapper"
                    aria-label="Page navigation"
                >
                    <a
                        rel="prev"
                        href="authentication.html"
                        class="nav-chapters previous"
                        title="Previous chapter"
                        aria-label="Previous chapter"
                        aria-keyshortcuts="Left"
                    >
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a
                        rel="next prefetch"
                        href="npm.html"
                        class="nav-chapters next"
                        title="Next chapter"
                        aria-label="Next chapter"
                        aria-keyshortcuts="Right"
                    >
                        <i class="fa fa-angle-right"></i>
                    </a>
                </nav>
            </div>

            <script>
                window.playground_copyable = true;
            </script>

            <script src="elasticlunr.min.js"></script>
            <script src="mark.min.js"></script>
            <script src="searcher.js"></script>

            <script src="clipboard.min.js"></script>
            <script src="highlight.js"></script>
            <script src="book.js"></script>

            <!-- Custom JS scripts -->
        </div>
    </body>
</html>
